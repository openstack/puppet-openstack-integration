---
- job:
    name: puppet-openstack-integration-base
    abstract: true
    parent: puppet-openstack-base
    required-projects:
      - openstack/openstack
      - name: openstack/puppet-aodh
        override-checkout: stable/wallaby
      - name: openstack/puppet-barbican
        override-checkout: stable/wallaby
      - name: openstack/puppet-ceilometer
        override-checkout: stable/wallaby
      - name: openstack/puppet-ceph
      - name: openstack/puppet-cinder
        override-checkout: stable/wallaby
      - name: openstack/puppet-cloudkitty
        override-checkout: stable/wallaby
      - name: openstack/puppet-designate
        override-checkout: stable/wallaby
      - name: openstack/puppet-ec2api
        override-checkout: stable/wallaby
      - name: openstack/puppet-glance
        override-checkout: stable/wallaby
      - name: openstack/puppet-gnocchi
        override-checkout: stable/wallaby
      - name: openstack/puppet-heat
        override-checkout: stable/wallaby
      - name: openstack/puppet-horizon
        override-checkout: stable/wallaby
      - name: openstack/puppet-ironic
        override-checkout: stable/wallaby
      - name: openstack/puppet-keystone
        override-checkout: stable/wallaby
      - name: openstack/puppet-magnum
        override-checkout: stable/wallaby
      - name: openstack/puppet-manila
        override-checkout: stable/wallaby
      - name: openstack/puppet-mistral
        override-checkout: stable/wallaby
      - name: openstack/puppet-monasca
        override-checkout: stable/wallaby
      - name: x/puppet-modulesync-configs
        override-checkout: stable/wallaby
      - name: openstack/puppet-murano
        override-checkout: stable/wallaby
      - name: openstack/puppet-neutron
        override-checkout: stable/wallaby
      - name: openstack/puppet-nova
        override-checkout: stable/wallaby
      - name: openstack/puppet-octavia
        override-checkout: stable/wallaby
      - name: openstack/puppet-openstack-cookiecutter
      - name: openstack/puppet-openstack-integration
        override-checkout: stable/wallaby
      - name: openstack/puppet-openstack_extras
        override-checkout: stable/wallaby
      - name: openstack/puppet-openstack_spec_helper
        override-checkout: stable/wallaby
      - name: openstack/puppet-openstacklib
        override-checkout: stable/wallaby
      - name: openstack/puppet-oslo
        override-checkout: stable/wallaby
      - name: openstack/puppet-ovn
        override-checkout: stable/wallaby
      - name: openstack/puppet-panko
        override-checkout: stable/wallaby
      - name: openstack/puppet-placement
        override-checkout: stable/wallaby
      - name: openstack/puppet-qdr
        override-checkout: stable/wallaby
      - name: openstack/puppet-sahara
        override-checkout: stable/wallaby
      - name: openstack/puppet-swift
        override-checkout: stable/wallaby
      - name: openstack/puppet-tacker
        override-checkout: stable/wallaby
      - name: openstack/puppet-tempest
        override-checkout: stable/wallaby
      - name: openstack/puppet-trove
        override-checkout: stable/wallaby
      - name: openstack/puppet-vswitch
        override-checkout: stable/wallaby
      - name: openstack/puppet-vitrage
        override-checkout: stable/wallaby
      - name: openstack/puppet-watcher
        override-checkout: stable/wallaby
      - name: openstack/puppet-zaqar
        override-checkout: stable/wallaby
      - name: openstack/tempest
        override-checkout: 27.0.0

- job:
    name: puppet-openstack-integration-run-base
    parent: puppet-openstack-integration-base
    abstract: true
    pre-run: playbooks/prepare-node-integration.yaml
    run: playbooks/run-integration-tests.yaml
    post-run:
      - playbooks/copy-logs.yaml
      - playbooks/upload-logs.yaml
    timeout: 7200
    irrelevant-files:
      - ^.*\.md$
      - ^.*\.rst$
      - ^doc/.*$
      - ^metadata.json$
      - ^releasenotes/.*$
      - ^spec/.*$
      - ^requirements.txt$
      - ^test-requirements.txt$
      - ^LICENSE$
      - ^.gitreview$
      - ^.gitignore$
      - ^setup.cfg$
      - ^setup.py$
      - ^tox.ini$
    roles:
      - zuul: zuul/zuul-jobs
    vars:
      ceph: octopus

- job:
    name: puppet-openstack-base
    pre-run: playbooks/prepare-node-common.yaml
    abstract: true
    nodeset: ubuntu-focal
    vars:
      puppet: 6
      use_puppetlabs: false

- job:
    name: puppet-openstack-module-base
    parent: puppet-openstack-base
    pre-run: playbooks/prepare-node-unit.yaml


- job:
    name: puppet-openstack-syntax-base
    parent: puppet-openstack-module-base
    run: playbooks/run-syntax-tests.yaml
    irrelevant-files:
      - ^.*\.md$
      - ^.*\.rst$
      - ^doc/.*$
      - ^etc/.*$
      - ^metadata.json$
      - ^releasenotes/.*$
      - ^requirements.txt$
      - ^test-requirements.txt$
      - ^LICENSE$
      - ^.gitreview$
      - ^.gitignore$
      - ^setup.cfg$
      - ^setup.py$
      - ^tox.ini$

- job:
    name: puppet-openstack-unit-base
    parent: puppet-openstack-integration-base
    run: playbooks/run-unit-tests.yaml
    pre-run: playbooks/prepare-node-unit.yaml
    timeout: 3600
    irrelevant-files:
      - ^.*\.md$
      - ^.*\.rst$
      - ^doc/.*$
      - ^etc/.*$
      - ^metadata.json$
      - ^releasenotes/.*$
      - ^requirements.txt$
      - ^test-requirements.txt$
      - ^spec/acceptance/.*$
      - ^LICENSE$
      - ^.gitreview$
      - ^.gitignore$
      - ^setup.cfg$
      - ^setup.py$
      - ^tox.ini$
    # TODO(tobias-urdin): Remove when we use rspec-puppet 2.7.1
    vars:
      rspec_puppet_version: '~> 2.3.0'

- job:
    name: puppet-openstack-libraries-puppet-unit-base
    parent: puppet-openstack-integration-base
    run: playbooks/run-libraries-unit-tests.yaml
    pre-run: playbooks/prepare-node-unit.yaml
    timeout: 3600
    irrelevant-files:
      - ^.*\.md$
      - ^.*\.rst$
      - ^doc/.*$
      - ^etc/.*$
      - ^metadata.json$
      - ^releasenotes/.*$
      - ^requirements.txt$
      - ^test-requirements.txt$
      - ^LICENSE$
      - ^.gitreview$
      - ^.gitignore$
      - ^setup.cfg$
      - ^setup.py$
      - ^tox.ini$
    # TODO(tobias-urdin): Remove when we use rspec-puppet 2.7.1
    vars:
      rspec_puppet_version: '~> 2.3.0'
